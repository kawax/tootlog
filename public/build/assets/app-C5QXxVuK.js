import{l as E,a as R,f as x,p as k,t as T,o as s,c as i,b as t,u as c,d as M,e as p,g as u,F as d,r as m,h as A,i as B,w as D,j as b,n as v,k as w,m as q}from"./vendor-Cn_lBVkY.js";window._=E;window.axios=R;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";function H(e){return x(k(e),"yyyy-MM-dd HH:mm:ss")}function f(e){return T.parse(e)}function y(e){return e.display_name?f(e.display_name):e.username}const P={class:"badge bg-info ms-1"},V=["src"],W=["innerHTML"],F={class:"d-flex m-1 p-1"},z={class:"flex-shrink-0"},J=["href"],U=["src"],X={class:"flex-grow-1 ms-3"},G=["href","innerHTML"],I={class:"text-muted"},K=["innerHTML"],Q=["innerHTML"],Y=["href"],Z=["src"],ee=["href"],te={__name:"TimelineReblog",props:{post:Object},setup(e){return(o,n)=>(s(),i("div",null,[t("span",P,[t("img",{class:"rounded-circle toot-icon-small",src:e.post.account.avatar},null,8,V),t("span",{innerHTML:c(y)(e.post.account)},null,8,W),M(" reblogged ")]),t("div",F,[t("div",z,[t("a",{href:e.post.reblog.account.url,target:"_blank",rel:"nofollow noopener",class:"text-decoration-none"},[t("img",{class:"rounded toot-icon",src:e.post.reblog.account.avatar},null,8,U)],8,J)]),t("div",X,[t("h4",null,[t("a",{href:e.post.reblog.account.url,innerHTML:c(y)(e.post.reblog.account),target:"_blank",rel:"nofollow noopener",class:"text-decoration-none"},null,8,G),t("small",I," @"+p(e.post.reblog.account.acct),1)]),e.post.reblog.spoiler_text.length>0?(s(),i("button",{key:0,class:"btn btn-warning btn-sm",type:"button",innerHTML:c(f)(e.post.reblog.spoiler_text),onClick:n[0]||(n[0]=a=>{e.post.reblog.spoiler_text=""})},null,8,K)):u("",!0),e.post.reblog.spoiler_text?u("",!0):(s(),i("div",{key:1,innerHTML:c(f)(e.post.reblog.content)},null,8,Q)),e.post.reblog.media_attachments?(s(!0),i(d,{key:2},m(e.post.reblog.media_attachments,a=>(s(),i("div",null,[t("a",{href:a.url,target:"_blank",ref_for:!0,ref:"nofollow noopener",class:"text-decoration-none"},[t("img",{src:a.preview_url,class:"img-responsive img-thumbnail"},null,8,Z)],8,Y)]))),256)):u("",!0),t("div",null,[t("a",{href:e.post.reblog.url,target:"_blank",ref:"nofollow noopener",class:"text-decoration-none"},p(c(H)(e.post.reblog.created_at)),9,ee)])])])]))}},oe={class:"d-flex p-1 m-1"},ne={class:"flex-shrink-0"},se=["href"],ie=["src"],le={class:"flex-grow-1 ms-3"},ae=["href","innerHTML"],re={class:"text-muted"},ce=["innerHTML"],ue=["innerHTML"],de=["href"],me=["src"],he=["href"],_e={__name:"TimelineStatus",props:{post:Object},setup(e){return(o,n)=>(s(),i("div",oe,[t("div",ne,[t("a",{href:e.post.account.url,target:"_blank",rel:"nofollow noopener",class:"text-decoration-none"},[t("img",{class:"rounded toot-icon",src:e.post.account.avatar},null,8,ie)],8,se)]),t("div",le,[t("h4",null,[t("a",{href:e.post.account.url,innerHTML:c(y)(e.post.account),target:"_blank",rel:"nofollow noopener",class:"text-decoration-none"},null,8,ae),t("small",re," @"+p(e.post.account.acct),1)]),e.post.spoiler_text.length>0?(s(),i("button",{key:0,class:"btn btn-warning btn-sm",type:"button",innerHTML:c(f)(e.post.spoiler_text),onClick:n[0]||(n[0]=a=>{e.post.spoiler_text=""})},null,8,ce)):u("",!0),e.post.spoiler_text?u("",!0):(s(),i("div",{key:1,innerHTML:c(f)(e.post.content)},null,8,ue)),e.post.media_attachments?(s(!0),i(d,{key:2},m(e.post.media_attachments,a=>(s(),i("div",null,[t("a",{href:a.url,target:"_blank",ref_for:!0,ref:"nofollow noopener",class:"text-decoration-none"},[t("img",{src:a.preview_url,class:"img-responsive img-thumbnail"},null,8,me)],8,de)]))),256)):u("",!0),t("div",null,[t("a",{href:e.post.url,target:"_blank",ref:"nofollow noopener",class:"text-decoration-none"},p(c(H)(e.post.created_at)),9,he)])])]))}},L=(e,o)=>{const n=e.__vccOpts||e;for(const[a,l]of o)n[a]=l;return n},pe={},fe={class:"card"},ge={class:"card bg-white"};function be(e,o){return s(),i("div",fe,[t("div",ge,[A(e.$slots,"default")])])}const ye=L(pe,[["render",be]]),ve={components:{TimelineReblog:te,TimelineStatus:_e,Card:ye},data(){return{api_version:"/api/v1",ws:null,types:{user:'<i class="fa fa-home" aria-hidden="true"></i> User',"public:local":'<i class="fa fa-users" aria-hidden="true"></i> Local',public:'<i class="fa fa-globe" aria-hidden="true"></i> Federated'},active_type:"public:local",timelines:{user:"home","public:local":"public?local=true",public:"public"},titles:{mention:"mentioned you",reblog:"boosted your status",favourite:"favourited your status",follow:"followed you"},media:{normal:'<i class="fa fa-file-image-o" aria-hidden="true"></i> Media Default',only:'<i class="fa fa-picture-o" aria-hidden="true"></i> Only',except:'<i class="fa fa-commenting-o" aria-hidden="true"></i> Except'},active_media:"normal",posts:[],count:0,max:50,errors:[]}},computed:{endpoint(){return this.domain+this.api_version},streaming_url(){return this.streaming+this.api_version},activePosts(){return this.posts.filter(e=>this.media_check(e))}},props:{domain:String,streaming:String,token:String},mounted(){this.get(this.active_type)},methods:{get(e="public:local"){this.steam_close(),this.active_type=e;const o=this.timelines[e];axios.get(this.endpoint+"/timelines/"+o+"?limit=20",{headers:{Authorization:"Bearer "+this.token}}).then(n=>{console.log(n),this.posts=n.data,this.stream(e)}).catch(n=>{console.log(n),typeof n.response.data=="object"?this.errors=_.flatten(_.toArray(n.response.data)):this.errors=["Something went wrong. Please try again."]})},stream(e="public:local"){this.steam_open(e,o=>{if(o.event==="notification"){console.log(o);let n=_.isEmpty(o.payload.account.display_name)?o.payload.account.username:o.payload.account.display_name,a=this.notificationTitle(o.payload.type,n),l=_.isEmpty(o.payload.status.spoiler_text)?o.payload.status.content:o.payload.status.spoiler_text;l=$("<p>").html(l).text(),"Notification"in window&&("Audio"in window&&new Audio(require("../../sounds/boop2.mp3")).play(),Notification.requestPermission().then(()=>{new Notification(a,{body:l,icon:o.payload.account.avatar,tag:o.payload.id})}))}else o.event==="update"&&(this.posts.unshift(o.payload),this.posts.splice(this.max))})},steam_open(e,o){this.ws=new WebSocket(this.streaming_url+"/streaming?access_token="+this.token+"&stream="+e),this.ws.onmessage=n=>{console.log("Got Data from Stream "+e),n=JSON.parse(n.data),n.payload=JSON.parse(n.payload),o(n)},this.ws.onclose=n=>{console.log("WebSocket Close "+e)}},steam_close(){_.isNull(this.ws)||(this.ws.close(),this.posts=[])},media_check(e){return this.active_media==="only"?(console.log(e),!_.isEmpty(e.media_attachments)):this.active_media==="except"?_.isEmpty(e.media_attachments):!0},notificationTitle(e,o){return o+" "+this.titles[e]},formatDate(e){return x(k(e),"yyyy-MM-dd HH:mm:ss")}}},we={class:"btn-toolbar mb-2",role:"toolbar","aria-label":"toolbar"},xe={class:"btn-group pe-1",role:"group"},ke=["onClick","innerHTML"],Te={class:"btn-group",role:"group"},$e=["onClick","innerHTML"],Me={key:0,class:"alert alert-danger"},He=t("p",null,[t("strong",null,"Whoops!"),M(" Something went wrong!")],-1),Le=t("hr",null,null,-1);function Se(e,o,n,a,l,g){const C=b("TimelineReblog"),N=b("TimelineStatus"),O=b("Card");return s(),i("div",null,[t("div",we,[t("div",xe,[(s(!0),i(d,null,m(l.types,(r,h)=>(s(),i("button",{type:"button",class:v(["btn btn-secondary",{active:l.active_type===h}]),onClick:j=>{g.get(h)},innerHTML:r},null,10,ke))),256))]),t("div",Te,[(s(!0),i(d,null,m(l.media,(r,h)=>(s(),i("button",{type:"button",class:v(["btn btn-secondary",{active:l.active_media===h}]),onClick:j=>{l.active_media=h},innerHTML:r},null,10,$e))),256))])]),l.errors.length>0?(s(),i("div",Me,[He,t("ul",null,[(s(!0),i(d,null,m(l.errors,r=>(s(),i("li",null,p(r),1))),256))])])):u("",!0),B(O,null,{default:D(()=>[(s(!0),i(d,null,m(g.activePosts,r=>(s(),i("div",null,[r.reblog?(s(),w(C,{key:0,post:r},null,8,["post"])):(s(),w(N,{key:1,post:r},null,8,["post"])),Le]))),256))]),_:1})])}const Ce=L(ve,[["render",Se]]),S=q({});S.component("tt-user-timeline",Ce);S.mount("#app");T.parse(document.body);
