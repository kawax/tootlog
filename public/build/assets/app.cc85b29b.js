import{l as L,a as M,t as k,f as v,p as w,o as a,c as n,b as t,d as g,e as b,F as d,r as m,g as F,h as C,i as S,w as T,j as u,n as x,k as y,m as Y}from"./vendor.eea18f8e.js";window._=L;window.axios=M;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";var z={toImage(o){return k.parse(o)}},h=(o,r)=>{const e=o.__vccOpts||o;for(const[s,f]of r)e[s]=f;return e};const H={props:{post:Object},methods:{display_name(){return this.post.account.display_name.length>0?this.emoji(this.post.account.display_name):this.post.account.username},reblog_display_name(){return this.post.reblog.account.display_name?this.emoji(this.post.reblog.account.display_name):this.post.reblog.account.username},emoji(o){return z.toImage(o)},formatDate(o){return v(w(o),"yyyy-MM-dd HH:mm:ss")}}},I={class:"badge bg-info ms-1"},N=["src"],R=["innerHTML"],E=F(" reblogged "),J={class:"d-flex m-1 p-1"},O={class:"flex-shrink-0"},G=["href"],P=["src"],D={class:"flex-grow-1 ms-3"},U=["href","innerHTML"],V={class:"text-muted"},W=["innerHTML"],K=["innerHTML"],X=["href"],Q=["src"],Z=["href"];function ee(o,r,e,s,f,i){return a(),n("div",null,[t("span",I,[t("img",{class:"rounded-circle toot-icon-small",src:e.post.account.avatar},null,8,N),t("span",{innerHTML:i.display_name()},null,8,R),E]),t("div",J,[t("div",O,[t("a",{href:e.post.reblog.account.url,target:"_blank",rel:"nofollow noopener"},[t("img",{class:"rounded toot-icon",src:e.post.reblog.account.avatar},null,8,P)],8,G)]),t("div",D,[t("h4",null,[t("a",{href:e.post.reblog.account.url,innerHTML:i.reblog_display_name(),target:"_blank",rel:"nofollow noopener"},null,8,U),t("small",V," @"+g(e.post.reblog.account.acct),1)]),e.post.reblog.spoiler_text.length>0?(a(),n("button",{key:0,class:"btn btn-warning btn-sm",type:"button",innerHTML:i.emoji(e.post.reblog.spoiler_text),onClick:r[0]||(r[0]=l=>{e.post.reblog.spoiler_text=""})},null,8,W)):b("",!0),e.post.reblog.spoiler_text?b("",!0):(a(),n("div",{key:1,innerHTML:i.emoji(e.post.reblog.content)},null,8,K)),e.post.reblog.media_attachments?(a(!0),n(d,{key:2},m(e.post.reblog.media_attachments,l=>(a(),n("div",null,[t("a",{href:l.url,target:"_blank",ref_for:!0,ref:"nofollow noopener"},[t("img",{src:l.preview_url,class:"img-responsive img-thumbnail"},null,8,Q)],8,X)]))),256)):b("",!0),t("div",null,[t("a",{href:e.post.reblog.url,target:"_blank",ref:"nofollow noopener"},g(i.formatDate(e.post.reblog.created_at)),9,Z)])])])])}var oe=h(H,[["render",ee]]);const te={props:{post:Object},methods:{display_name(){return this.post.account.display_name?this.emoji(this.post.account.display_name):this.post.account.username},emoji(o){return z.toImage(o)},formatDate(o){return v(w(o),"yyyy-MM-dd HH:mm:ss")}}},re={class:"d-flex p-1 m-1"},ae={class:"flex-shrink-0"},ne=["href"],fe=["src"],ie={class:"flex-grow-1 ms-3"},le=["href","innerHTML"],ce={class:"text-muted"},be=["innerHTML"],se=["innerHTML"],de=["href"],me=["src"],pe=["href"];function ge(o,r,e,s,f,i){return a(),n("div",re,[t("div",ae,[t("a",{href:e.post.account.url,target:"_blank",rel:"nofollow noopener"},[t("img",{class:"rounded toot-icon",src:e.post.account.avatar},null,8,fe)],8,ne)]),t("div",ie,[t("h4",null,[t("a",{href:e.post.account.url,innerHTML:i.display_name(),target:"_blank",rel:"nofollow noopener"},null,8,le),t("small",ce," @"+g(e.post.account.acct),1)]),e.post.spoiler_text.length>0?(a(),n("button",{key:0,class:"btn btn-warning btn-sm",type:"button",innerHTML:i.emoji(e.post.spoiler_text),onClick:r[0]||(r[0]=l=>{e.post.spoiler_text=""})},null,8,be)):b("",!0),e.post.spoiler_text?b("",!0):(a(),n("div",{key:1,innerHTML:i.emoji(e.post.content)},null,8,se)),e.post.media_attachments?(a(!0),n(d,{key:2},m(e.post.media_attachments,l=>(a(),n("div",null,[t("a",{href:l.url,target:"_blank",ref_for:!0,ref:"nofollow noopener"},[t("img",{src:l.preview_url,class:"img-responsive img-thumbnail"},null,8,me)],8,de)]))),256)):b("",!0),t("div",null,[t("a",{href:e.post.url,target:"_blank",ref:"nofollow noopener"},g(i.formatDate(e.post.created_at)),9,pe)])])])}var he=h(te,[["render",ge]]);const ue={},ve={class:"card"},we={class:"card bg-white"};function xe(o,r){return a(),n("div",ve,[t("div",we,[C(o.$slots,"default")])])}var ye=h(ue,[["render",xe]]);const ke={components:{TimelineReblog:oe,TimelineStatus:he,Card:ye},data(){return{api_version:"/api/v1",ws:null,types:{user:'<i class="fa fa-home" aria-hidden="true"></i> User',"public:local":'<i class="fa fa-users" aria-hidden="true"></i> Local',public:'<i class="fa fa-globe" aria-hidden="true"></i> Federated'},active_type:"public:local",timelines:{user:"home","public:local":"public?local=true",public:"public"},titles:{mention:"mentioned you",reblog:"boosted your status",favourite:"favourited your status",follow:"followed you"},media:{normal:'<i class="fa fa-file-image-o" aria-hidden="true"></i> Media Default',only:'<i class="fa fa-picture-o" aria-hidden="true"></i> Only',except:'<i class="fa fa-commenting-o" aria-hidden="true"></i> Except'},active_media:"normal",posts:[],count:0,max:50,errors:[]}},computed:{endpoint(){return this.domain+this.api_version},streaming_url(){return this.streaming+this.api_version},activePosts(){return this.posts.filter(o=>this.media_check(o))}},props:{domain:String,streaming:String,token:String},mounted(){this.get(this.active_type)},methods:{get(o="public:local"){this.steam_close(),this.active_type=o;const r=this.timelines[o];axios.get(this.endpoint+"/timelines/"+r+"?limit=20",{headers:{Authorization:"Bearer "+this.token}}).then(e=>{console.log(e),this.posts=e.data,this.stream(o)}).catch(e=>{console.log(e),typeof e.response.data=="object"?this.errors=_.flatten(_.toArray(e.response.data)):this.errors=["Something went wrong. Please try again."]})},stream(o="public:local"){this.steam_open(o,r=>{if(r.event==="notification"){console.log(r);let e=_.isEmpty(r.payload.account.display_name)?r.payload.account.username:r.payload.account.display_name,s=this.notificationTitle(r.payload.type,e),f=_.isEmpty(r.payload.status.spoiler_text)?r.payload.status.content:r.payload.status.spoiler_text;f=$("<p>").html(f).text(),"Notification"in window&&("Audio"in window&&new Audio(require("../../sounds/boop2.mp3")).play(),Notification.requestPermission().then(()=>{new Notification(s,{body:f,icon:r.payload.account.avatar,tag:r.payload.id})}))}else r.event==="update"&&(this.posts.unshift(r.payload),this.posts.splice(this.max))})},steam_open(o,r){this.ws=new WebSocket(this.streaming_url+"/streaming?access_token="+this.token+"&stream="+o),this.ws.onmessage=e=>{console.log("Got Data from Stream "+o),e=JSON.parse(e.data),e.payload=JSON.parse(e.payload),r(e)},this.ws.onclose=e=>{console.log("WebSocket Close "+o)}},steam_close(){_.isNull(this.ws)||(this.ws.close(),this.posts=[])},media_check(o){return this.active_media==="only"?(console.log(o),!_.isEmpty(o.media_attachments)):this.active_media==="except"?_.isEmpty(o.media_attachments):!0},notificationTitle(o,r){return r+" "+this.titles[o]},formatDate(o){return v(w(o),"yyyy-MM-dd HH:mm:ss")}}},Fe={class:"btn-toolbar mb-2",role:"toolbar","aria-label":"toolbar"},ze={class:"btn-group pe-1",role:"group"},Ae=["onClick","innerHTML"],_e={class:"btn-group",role:"group"},qe=["onClick","innerHTML"],je={key:0,class:"alert alert-danger"},Be=t("p",null,[t("strong",null,"Whoops!"),F(" Something went wrong!")],-1),Le=t("hr",null,null,-1);function Me(o,r,e,s,f,i){const l=u("TimelineReblog"),q=u("TimelineStatus"),j=u("Card");return a(),n("div",null,[t("div",Fe,[t("div",ze,[(a(!0),n(d,null,m(f.types,(c,p)=>(a(),n("button",{type:"button",class:x(["btn btn-secondary",{active:f.active_type===p}]),onClick:B=>{i.get(p)},innerHTML:c},null,10,Ae))),256))]),t("div",_e,[(a(!0),n(d,null,m(f.media,(c,p)=>(a(),n("button",{type:"button",class:x(["btn btn-secondary",{active:f.active_media===p}]),onClick:B=>{f.active_media=p},innerHTML:c},null,10,qe))),256))])]),f.errors.length>0?(a(),n("div",je,[Be,t("ul",null,[(a(!0),n(d,null,m(f.errors,c=>(a(),n("li",null,g(c),1))),256))])])):b("",!0),S(j,null,{default:T(()=>[(a(!0),n(d,null,m(i.activePosts,c=>(a(),n("div",null,[c.reblog?(a(),y(l,{key:0,post:c},null,8,["post"])):(a(),y(q,{key:1,post:c},null,8,["post"])),Le]))),256))]),_:1})])}var Ce=h(ke,[["render",Me]]);const A=Y({});A.component("tt-user-timeline",Ce);A.mount("#app");k.parse(document.body);
