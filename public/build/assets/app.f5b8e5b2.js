import{l as L,j as M,a as S,t as k,f as w,p as x,o as r,c as a,b as t,d as g,e as d,F as b,r as s,g as F,h as C,i as I,w as N,k as h,n as v,m as y,q as T}from"./vendor.09d1595c.js";window._=L;try{window.$=window.jQuery=M}catch{}window.axios=S;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";var z={toImage(o){return k.parse(o)}},u=(o,n)=>{const e=o.__vccOpts||o;for(const[m,f]of n)e[m]=f;return e};const H={props:{post:Object},methods:{display_name(){return this.post.account.display_name.length>0?this.emoji(this.post.account.display_name):this.post.account.username},reblog_display_name(){return this.post.reblog.account.display_name?this.emoji(this.post.reblog.account.display_name):this.post.reblog.account.username},emoji(o){return z.toImage(o)},formatDate(o){return w(x(o),"yyyy-MM-dd HH:mm:ss")}}},E={class:"badge badge-info ml-1"},U=["src"],Y=["innerHTML"],R=F(" reblogged "),J={class:"media m-1 p-1"},O=["href"],P=["src"],D={class:"media-body ml-3"},V=["href","innerHTML"],W={class:"text-muted"},K=["innerHTML"],X=["innerHTML"],G=["href"],Q=["src"],Z=["href"];function ee(o,n,e,m,f,i){return r(),a("div",null,[t("span",E,[t("img",{class:"rounded-circle toot-icon-small",src:e.post.account.avatar},null,8,U),t("span",{innerHTML:i.display_name()},null,8,Y),R]),t("div",J,[t("a",{href:e.post.reblog.account.url,target:"_blank",rel:"nofollow noopener"},[t("img",{class:"rounded toot-icon",src:e.post.reblog.account.avatar},null,8,P)],8,O),t("div",D,[t("h4",null,[t("a",{href:e.post.reblog.account.url,innerHTML:i.reblog_display_name(),target:"_blank",rel:"nofollow noopener"},null,8,V),t("small",W," @"+g(e.post.reblog.account.acct),1)]),e.post.reblog.spoiler_text.length>0?(r(),a("button",{key:0,class:"btn btn-warning btn-sm",type:"button",innerHTML:i.emoji(e.post.reblog.spoiler_text),onClick:n[0]||(n[0]=l=>{e.post.reblog.spoiler_text=""})},null,8,K)):d("",!0),e.post.reblog.spoiler_text?d("",!0):(r(),a("div",{key:1,innerHTML:i.emoji(e.post.reblog.content)},null,8,X)),e.post.reblog.media_attachments?(r(!0),a(b,{key:2},s(e.post.reblog.media_attachments,l=>(r(),a("div",null,[t("a",{href:l.url,target:"_blank",ref_for:!0,ref:"nofollow noopener"},[t("img",{src:l.preview_url,class:"img-responsive img-thumbnail"},null,8,Q)],8,G)]))),256)):d("",!0),t("div",null,[t("a",{href:e.post.reblog.url,target:"_blank",ref:"nofollow noopener"},g(i.formatDate(e.post.reblog.created_at)),9,Z)])])])])}var oe=u(H,[["render",ee]]);const te={props:{post:Object},methods:{display_name(){return this.post.account.display_name?this.emoji(this.post.account.display_name):this.post.account.username},emoji(o){return z.toImage(o)},formatDate(o){return w(x(o),"yyyy-MM-dd HH:mm:ss")}}},ne={class:"media p-1 m-1"},re=["href"],ae=["src"],fe={class:"media-body ml-3"},ie=["href","innerHTML"],le={class:"text-muted"},ce=["innerHTML"],de=["innerHTML"],me=["href"],be=["src"],se=["href"];function pe(o,n,e,m,f,i){return r(),a("div",ne,[t("a",{href:e.post.account.url,target:"_blank",rel:"nofollow noopener"},[t("img",{class:"rounded toot-icon",src:e.post.account.avatar},null,8,ae)],8,re),t("div",fe,[t("h4",null,[t("a",{href:e.post.account.url,innerHTML:i.display_name(),target:"_blank",rel:"nofollow noopener"},null,8,ie),t("small",le," @"+g(e.post.account.acct),1)]),e.post.spoiler_text.length>0?(r(),a("button",{key:0,class:"btn btn-warning btn-sm",type:"button",innerHTML:i.emoji(e.post.spoiler_text),onClick:n[0]||(n[0]=l=>{e.post.spoiler_text=""})},null,8,ce)):d("",!0),e.post.spoiler_text?d("",!0):(r(),a("div",{key:1,innerHTML:i.emoji(e.post.content)},null,8,de)),e.post.media_attachments?(r(!0),a(b,{key:2},s(e.post.media_attachments,l=>(r(),a("div",null,[t("a",{href:l.url,target:"_blank",ref_for:!0,ref:"nofollow noopener"},[t("img",{src:l.preview_url,class:"img-responsive img-thumbnail"},null,8,be)],8,me)]))),256)):d("",!0),t("div",null,[t("a",{href:e.post.url,target:"_blank",ref:"nofollow noopener"},g(i.formatDate(e.post.created_at)),9,se)])])])}var ge=u(te,[["render",pe]]);const ue={},he={class:"card"},we={class:"card bg-white"};function xe(o,n){return r(),a("div",he,[t("div",we,[C(o.$slots,"default")])])}var ve=u(ue,[["render",xe]]);const ye={components:{TimelineReblog:oe,TimelineStatus:ge,Card:ve},data(){return{api_version:"/api/v1",ws:null,types:{user:'<i class="fa fa-home" aria-hidden="true"></i> User',"public:local":'<i class="fa fa-users" aria-hidden="true"></i> Local',public:'<i class="fa fa-globe" aria-hidden="true"></i> Federated'},active_type:"public:local",timelines:{user:"home","public:local":"public?local=true",public:"public"},titles:{mention:"mentioned you",reblog:"boosted your status",favourite:"favourited your status",follow:"followed you"},media:{normal:'<i class="fa fa-file-image-o" aria-hidden="true"></i> Media Default',only:'<i class="fa fa-picture-o" aria-hidden="true"></i> Only',except:'<i class="fa fa-commenting-o" aria-hidden="true"></i> Except'},active_media:"normal",posts:[],count:0,max:50,errors:[]}},computed:{endpoint(){return this.domain+this.api_version},streaming_url(){return this.streaming+this.api_version},activePosts(){return this.posts.filter(o=>this.media_check(o))}},props:{domain:String,streaming:String,token:String},mounted(){this.get(this.active_type)},methods:{get(o="public:local"){this.steam_close(),this.active_type=o;const n=this.timelines[o];axios.get(this.endpoint+"/timelines/"+n+"?limit=20",{headers:{Authorization:"Bearer "+this.token}}).then(e=>{console.log(e),this.posts=e.data,this.stream(o)}).catch(e=>{console.log(e),typeof e.response.data=="object"?this.errors=_.flatten(_.toArray(e.response.data)):this.errors=["Something went wrong. Please try again."]})},stream(o="public:local"){this.steam_open(o,n=>{if(n.event==="notification"){console.log(n);let e=_.isEmpty(n.payload.account.display_name)?n.payload.account.username:n.payload.account.display_name,m=this.notificationTitle(n.payload.type,e),f=_.isEmpty(n.payload.status.spoiler_text)?n.payload.status.content:n.payload.status.spoiler_text;f=$("<p>").html(f).text(),"Notification"in window&&("Audio"in window&&new Audio(require("../../sounds/boop2.mp3")).play(),Notification.requestPermission().then(()=>{new Notification(m,{body:f,icon:n.payload.account.avatar,tag:n.payload.id})}))}else n.event==="update"&&(this.posts.unshift(n.payload),this.posts.splice(this.max))})},steam_open(o,n){this.ws=new WebSocket(this.streaming_url+"/streaming?access_token="+this.token+"&stream="+o),this.ws.onmessage=e=>{console.log("Got Data from Stream "+o),e=JSON.parse(e.data),e.payload=JSON.parse(e.payload),n(e)},this.ws.onclose=e=>{console.log("WebSocket Close "+o)}},steam_close(){_.isNull(this.ws)||(this.ws.close(),this.posts=[])},media_check(o){return this.active_media==="only"?(console.log(o),!_.isEmpty(o.media_attachments)):this.active_media==="except"?_.isEmpty(o.media_attachments):!0},notificationTitle(o,n){return n+" "+this.titles[o]},formatDate(o){return w(x(o),"yyyy-MM-dd HH:mm:ss")}}},ke={class:"btn-toolbar mb-2",role:"toolbar","aria-label":"toolbar"},Fe={class:"btn-group pr-1",role:"group"},ze=["onClick","innerHTML"],Ae={class:"btn-group",role:"group"},_e=["onClick","innerHTML"],qe={key:0,class:"alert alert-danger"},je=t("p",null,[t("strong",null,"Whoops!"),F(" Something went wrong!")],-1),Be=t("hr",null,null,-1);function Le(o,n,e,m,f,i){const l=h("TimelineReblog"),q=h("TimelineStatus"),j=h("Card");return r(),a("div",null,[t("div",ke,[t("div",Fe,[(r(!0),a(b,null,s(f.types,(c,p)=>(r(),a("button",{type:"button",class:v(["btn btn-secondary",{active:f.active_type===p}]),onClick:B=>{i.get(p)},innerHTML:c},null,10,ze))),256))]),t("div",Ae,[(r(!0),a(b,null,s(f.media,(c,p)=>(r(),a("button",{type:"button",class:v(["btn btn-secondary",{active:f.active_media===p}]),onClick:B=>{f.active_media=p},innerHTML:c},null,10,_e))),256))])]),f.errors.length>0?(r(),a("div",qe,[je,t("ul",null,[(r(!0),a(b,null,s(f.errors,c=>(r(),a("li",null,g(c),1))),256))])])):d("",!0),I(j,null,{default:N(()=>[(r(!0),a(b,null,s(i.activePosts,c=>(r(),a("div",null,[c.reblog?(r(),y(l,{key:0,post:c},null,8,["post"])):(r(),y(q,{key:1,post:c},null,8,["post"])),Be]))),256))]),_:1})])}var Me=u(ye,[["render",Le]]);const A=T({});A.component("tt-user-timeline",Me);A.mount("#app");k.parse(document.body);
